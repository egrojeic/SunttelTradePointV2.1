@inject ContextMenuService ContextMenuService
@inject NavigationManager navigationManager
@using SunttelTradePointB.Shared.Sales;

@using Syncfusion.Blazor.Grids
@using Syncfusion.Blazor.DropDowns


<div class="panelMenuContainer">

    <RangeDatesInput @bind-StartDate="@startingDate" @bind-EndDate="@endDate"
                     EventSearchAll="EventSearchAll"></RangeDatesInput>
</div>


<div class="col-lg-12 control-section">
    <div class="content-wrapper">
        <div class="row">
            <SfGrid DataSource="@purchaseItemDetails" Toolbar="@(new List<string>() {  "Edit", "Update", "Cancel" })" AllowPaging="true">
                <GridEditSettings AllowAdding="true" AllowDeleting="true" AllowEditing="true"></GridEditSettings>
                <GridEvents OnActionBegin="ActionBegin" OnActionComplete="ActionComplete" TValue="PurchaseItemDetails"></GridEvents>
                <GridColumns>
                    <GridColumn HeaderText="Options" TextAlign="Syncfusion.Blazor.Grids.TextAlign.Center" Width="40">
                        <Template>
                            @{
                                var purchase = (context as PurchaseItemDetails);
                                <button class="btn btn-danger btn-sm" @onclick="() => CancelRequest(purchase)" title="Cancel Request" >
                                    <i class="oi oi-circle-x"></i>
                                </button>
                            }
                        </Template>
                    </GridColumn>
                    <GridColumn Field=@nameof(PurchaseItemDetails.Id) HeaderText="@GetName("Id",new PurchaseItemDetails())" IsPrimaryKey="true" ValidationRules="@(new ValidationRules{ Required=true})" TextAlign="Syncfusion.Blazor.Grids.TextAlign.Right" Width="50" ></GridColumn>
                    <GridColumn AllowEditing="false" Field=@nameof(PurchaseItemDetails.AssignedQty) HeaderText="@GetName("AssignedQty",new PurchaseItemDetails())" ValidationRules="@(new ValidationRules{ Required=true, Number=true})" TextAlign="Syncfusion.Blazor.Grids.TextAlign.Right" Width="50"></GridColumn>
                    <GridColumn Field=@nameof(PurchaseItemDetails.ConfirmedQty) HeaderText="@GetName("ConfirmedQty",new PurchaseItemDetails())" ValidationRules="@(new ValidationRules{ Required=true, Range = new object[]{1, 1000}})" EditType="EditType.NumericEdit" Format="C2" TextAlign="Syncfusion.Blazor.Grids.TextAlign.Right" Width="50"></GridColumn>
                    <GridColumn AllowEditing="false" Field=@nameof(PurchaseItemDetails.ExpectedCost) HeaderText="@GetName("ExpectedCost",new PurchaseItemDetails())" ValidationRules="@(new ValidationRules{ Required=true, Number=true})" TextAlign="Syncfusion.Blazor.Grids.TextAlign.Right" Width="50"></GridColumn>
                    <GridColumn Field=@nameof(PurchaseItemDetails.ConfirmedCost) HeaderText="@GetName("ConfirmedCost",new PurchaseItemDetails())" ValidationRules="@(new ValidationRules{ Required=true, Range = new object[]{1, 1000}})" EditType="EditType.NumericEdit" Format="C2" TextAlign="Syncfusion.Blazor.Grids.TextAlign.Right" Width="50"></GridColumn>
                    <GridColumn Field=@nameof(PurchaseItemDetails.ProviderShipDate) HeaderText="@GetName("ProviderShipDate",new PurchaseItemDetails())" AllowEditing="false" Width="50"></GridColumn>
                </GridColumns>
            </SfGrid>
        </div>
    </div>
</div>


@code {
    public List<PurchaseItemDetails> purchaseItemDetails = new List<PurchaseItemDetails>();
    DateTime startingDate = DateTime.Now, endDate = DateTime.Now.AddMonths(1);

    public void EventSearchAll(string value)
    {

    }

    protected override void OnInitialized()
    {
        base.OnInitialized();
        // Crear y agregar objetos a la lista
        PurchaseItemDetails item1 = new PurchaseItemDetails()
                {
                    Id = "1",
                    SalesDocumentItemsDetailsId = "100",
                    PurchaseDocumentItemsDetailsId = "200",
                    Provider = new BasicConcept()
                    {
                        Id = "2",
                        Name = "Provider 2"
                    },
                    AssignedQty = 10,
                    ConfirmedQty = 0,
                    ExpectedCost = 50.0,
                    ConfirmedCost = 40.0,
                    ProviderShipDate = DateTime.Now,
                    ISRejectedByProvider = false,
                    CancelationInfo = new CancelationTrack()
                };

        purchaseItemDetails.Add(item1);

        PurchaseItemDetails item2 = new PurchaseItemDetails()
                {
                    Id = "2",
                    SalesDocumentItemsDetailsId = "101",
                    PurchaseDocumentItemsDetailsId = "201",
                    Provider = new BasicConcept()
                    {
                        Id = "1",
                        Name = "Provider 1"
                    },
                    AssignedQty = 5,
                    ConfirmedQty = 0,
                    ExpectedCost = 20.0,
                    ConfirmedCost = 0,
                    ProviderShipDate = DateTime.Now.AddDays(1),
                    ISRejectedByProvider = true,
                    CancelationInfo = new CancelationTrack()
                };
        purchaseItemDetails.Add(item2);

        PurchaseItemDetails item3 = new PurchaseItemDetails()
                {
                    Id = "3",
                    SalesDocumentItemsDetailsId = "101",
                    PurchaseDocumentItemsDetailsId = "201",
                    Provider = new BasicConcept()
                    {
                        Id = "1",
                        Name = "Provider 1"
                    },
                    AssignedQty = 55,
                    ConfirmedQty = 0,
                    ExpectedCost = 20.0,
                    ConfirmedCost = 0,
                    ProviderShipDate = DateTime.Now.AddDays(1),
                    ISRejectedByProvider = true,
                    CancelationInfo = new CancelationTrack()
                };
        purchaseItemDetails.Add(item3);

    }

    public string GetName(string Name, Object Obj)
    {
        if (UICommonFunctions.GetDisplayName(Obj, Name) != null) Name = UICommonFunctions.GetDisplayName(Obj, Name);
        return Name;
    }

    public void ActionBegin(ActionEventArgs<PurchaseItemDetails> args)
    {
        if (args.RequestType == Syncfusion.Blazor.Grids.Action.BeginEdit)
        {
            // Triggers before editing operation starts
        }
        else if (args.RequestType == Syncfusion.Blazor.Grids.Action.Add)
        {
            // Triggers before add operation starts
        }
        else if (args.RequestType == Syncfusion.Blazor.Grids.Action.Cancel)
        {
            // Triggers before cancel operation starts
        }
        else if (args.RequestType == Syncfusion.Blazor.Grids.Action.Save)
        {
            // Triggers before save operation starts
        }
        else if (args.RequestType == Syncfusion.Blazor.Grids.Action.Delete)
        {
            // Triggers before delete operation starts
        }
    }

    public void ActionComplete(ActionEventArgs<PurchaseItemDetails> args)
    {
        if (args.RequestType == Syncfusion.Blazor.Grids.Action.BeginEdit)
        {
            // Triggers once editing operation completes
        }
        else if (args.RequestType == Syncfusion.Blazor.Grids.Action.Add)
        {
            // Triggers once add operation completes
        }
        else if (args.RequestType == Syncfusion.Blazor.Grids.Action.Cancel)
        {
            // Triggers once cancel operation completes
        }
        else if (args.RequestType == Syncfusion.Blazor.Grids.Action.Save)
        {
            // Triggers once save operation completes

            // This is the action that I need
        }
        else if (args.RequestType == Syncfusion.Blazor.Grids.Action.Delete)
        {
            // Triggers once delete operation completes
        }
    }

    public void CancelRequest(PurchaseItemDetails e)
    {
        Console.WriteLine(e.ToString());
    }
}
